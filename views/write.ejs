<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<style>
    /* .row {
        border: 1px solid red;
    }

    div[class^="col-"] {
        border: 1px solid green;
    } */

    #color-adj {
        background-color: #F2F2F2;
    }
</style>

<body>
    <div class="container mt-2">
        <!-- //////////////////////////////////////////// Welcome name -->
        <!-- //////////////////////////////////////////// Links -->
        <div class="row mb-5">
            <div class="col-12 col-sm-8 mx-auto text-right">

                <small id="welcome-name" class="text-left"></small>

                <a href="/articles/write">
                    <small>/ Write</small>
                </a>
                <a href="/articles/read">
                    <small>Read</small>
                </a>
            </div>
        </div>

        <div class="row mb-1">

            <div class="col-12 col-sm-8 mx-auto">       
                <h5 for="post-title-input"></h5>New post:</h5>
            </div>
        </div>
        <div class="row">
            <div id="color-adj" class="col-12 col-sm-8 mx-auto border rounded">

                <!-- //////////////////////////////////////////// Post Title -->
                <div class="row">
                    <div class="col-12 mt-3">
                        <input type="text" id="post-title-input" class="form-control" placeholder="title:">
                    </div>
                </div>

                <!-- //////////////////////////////////////////// Post Content -->
                <div class="row">
                    <div class="col-12 mt-2">
                        <textarea type="text" id="post-content-input" rows="6" class="form-control" placeholder="content:"></textarea>
                    </div>
                </div>

                <!-- //////////////////////////////////////////// Confirmation -->
                <div class="row">
                    <div class="col-12 mb-2 mt-2 text-left">
                        <small id="post-confirmation"></small>
                    </div>
                </div>

            </div>

            <div class="col-12 col-sm-8 mx-auto">

                <div class="row mt-3">
                    <div class="col-12 col-sm-8 text-right">
                        <button onclick="window.location='/articles/read';" class="btn btn-link btn-sm">
                            <small>view all posts</small>
                        </button>
                    </div>

                    <!-- //////////////////////////////////////////// Submit -->
                    <div class="col-12 col-sm-4 mx-right">
                        <button onclick="post()" class="btn btn-dark btn-md btn-block">Post</button>
                    </div>
                </div>

            </div>

            <!-- //////////////////////////////////////////// Last post -->
            <div class="col-12 col-sm-8 mx-auto">
                <p class="font-weight-normal" id="get-title-result"></p>
                <small class="font-weight-light" id="get-content-result"></small>

            </div>

        </div>
    </div>
</body>

<script>

    function getColor() {
        axios.get('/user/color')
            .then(function (response) {
                console.log(response.data)
                var element = document.getElementById("color-adj");
                element.style.backgroundColor = response.data;
            })
            .catch(function (error) {
                console.log(error);
            });
    };
    getColor();


    function getUserNameForTheTitle() {
        axios.get('/user')
            .then(function (response) {
                document.getElementById("welcome-name").innerHTML += response.data.username;
            })
            .catch(function (error) {
                console.log(error);
            });
    };
    getUserNameForTheTitle();





    function getLastArticle() {
        axios.get("/articles/last")
            .then(function (response) {
                console.log(response.data);
                if (!response.data) return;

                var date = new Date(response.data.datePosted).toLocaleString();
                var title = response.data.title;
                var content = response.data.content;
                var result = "<small><small>Your last post : <br>" + date + "</small></small><small><br><b>" + title + "</b><br>" + content + "</small><hr>";

                // console.log(result);
                document.getElementById("get-title-result").innerHTML += result;
            })
            .catch(function (error) {
                console.log(error);
            });
    };
    getLastArticle();


    function post() {
        var title = document.getElementById("post-title-input").value;
        var content = document.getElementById("post-content-input").value;

        var data = {
            "datePosted": Date.now(),
            "title": title,
            "content": content,
        };

        axios.post("/articles", data)
            .then(function (response) {
                document.getElementById("post-confirmation").innerHTML = response.data;
                setTimeout(function () {
                    window.location = "/articles/write";
                }, 250);
            })
            .catch(function (error) {
                console.log(error);
            });
    };

</script>

</html>